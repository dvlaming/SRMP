# The impact of assumption violations on test results {#sec-a2tests}

Although we have discussed checking for bias in the model, you will likely have noticed that assumption tests are very rarely reported in the psychological literature, which could lead you to question the influence that assumption violations have on inference.

Normally, we do not know whether $H_0$ or $H_1$ is true, but simulations allow us to fix "population" parameters and then draw samples to investigate how robust our hypothesis tests are against assumption violations. For example, we can look at whether independent-samples t-tests produce results in line with our given $\alpha$ level by repeatedly drawing groups from a simulated population where $\mu$ = 0 (i.e., where both groups come from the same null population where there is no treatment effect) and calculating the proportion of significant test results. On the other hand, we can determine whether the power of a test is in line with expectations by drawing groups from populations with **different**
 values of $\mu$, and counting the instances where the test detected the "true" effect. 
 
 
```{r}

## adapted from: https://github.com/lmu-osc/Introduction-Simulations-in-R/blob/main/exercise_script_with_solutions.R
simT <- function(n1, n2, m1, m2, sd1, sd2){
  x1 <- rnorm(n1,m1,sd1)
  x2 <- rnorm(n2,m2,sd2)
  t.test(x1, x2, var.equal = TRUE)$p.value # assume equal variances
}
```


## Normality

Coming soon...

## Homogeneity of variances

### Type-I error rate ($\alpha$)

```{r}
#| fig-height: 10

## adapted from: https://github.com/lmu-osc/Introduction-Simulations-in-R/blob/main/exercise_script_with_solutions.R

set.seed(291086)

n1<-seq(30,120,10)
n2<-seq(20,110,10)
n3<-seq(10,100,10)

eqres<-numeric(length(n1))
uneqres<-numeric(length(n1))
uneqsampres<-numeric(length(n1))
hiuneqsampres<-numeric(length(n1))

# for(i in 1:length(n1)){
#   eqres[i]<-mean(replicate(5000, simT(n1[i],n1[i],0,0,1,1))<=.05) # equal var
#   uneqres[i]<-mean(replicate(5000, simT(n1[i],n1[i],0,0,1,2))<=.05) # unequal var
#   uneqsampres[i]<-mean(replicate(5000, simT(n1[i],n2[i],0,0,1,2))<=.05) # unequal var and sample size
#   hiuneqsampres[i]<-mean(replicate(5000, simT(n1[i],n3[i],0,0,1,2))<=.05)
# }
# 
# simTRep <- replicate(1000, simT(50,50,0,0,1,1)) # equal var
# simTRep_uneq <- replicate(1000, simT(50,50,0,0,1,1.5)) # unequal var
# simTRep_uneqsamp <- replicate(1000, simT(50,40,0,0,1,1.5)) # unequal var and sample size


# par(mfrow = c(3,1))
# hist(simTRep, breaks = 21, col = c('red',rep('grey',20)), 
#      main = "Equal variances, equal n (50)", xlab = "p-value")
# hist(simTRep_uneq, breaks = 21, col = c('red',rep('grey',20)), 
#      main = "Unequal variances, equal n (50)", xlab = "p-value")
# hist(simTRep_uneqsamp, breaks = 21, col = c('red',rep('grey',20)), 
#      main = "Unequal variances, unequal n (50, 40)", xlab = "p-value")

# False positive rate for:
# 
# 1. Equal variances and equal _n_ = `{r} mean(simTRep <= .05)`
# 2. Unequal variances and equal _n_ = `{r} mean(simTRep_uneq <= .05)`
# 3. Unequal variances and unequal _n_ = `{r} mean(simTRep_uneqsamp <= .05)`


```



### Power (1 - $\beta$)
